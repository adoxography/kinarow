<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>K-in-a-row</title>

  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="css/style.css">
  <script src="js/index.js"></script>
</head>
<body>
  <div
    class="links-container"
    :class="{ 'links-container--hidden': !show }"
    x-data="{ show: true }"
    @startgame.window="show = false"
    @gameover.window="show = true"
  >
    <a class="link" href="https://github.com/adoxography/kinarow">
      <svg class="link__icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" transform="scale(64)"/>
      </svg>
    </a>
  </div>

  <form
    class="controls"
    x-data="Control()"
    x-cloak
    x-init="
      $watch('width', () => update());
      $watch('height', () => update());
      $watch('k', () => update());
    "
    :class="{ 'controls--hidden': state === State.PLAY }"
    @submit.prevent="start"
    @gameover.window="state = State.SETUP"
  >
    <div class="field">
      <input
        type="number"
        class="field__input field__input--number"
        :disabled="state !== State.SETUP"
        x-model.number="width"
        @focus="$event.target.select()"
      >
      <span>x</span>
      <input
        type="number"
        class="field__input field__input--number"
        :disabled="state !== State.SETUP"
        x-model.number="height"
        @focus="$event.target.select()"
      >
    </div>

    <div class="field">
      <input
        type="number"
        class="field__input field__input--number"
        x-model.number="k"
        :disabled="state !== State.SETUP"
        @focus="$event.target.select()"
      > to win
    </div>

    <div>
      <template x-for="(agent, agentIndex) in agents" :key="agentIndex">
        <div class="field">
          <input
            type="text"
            class="field__input field__input--url"
            :placeholder="`Player ${agentIndex+1}`"
            :value="agent.url"
            @change="agent.url = $event.target.value; agent.ready = false;"
          >
          <div class="field__spinner">
            <div class="loader" x-show="state === State.WAIT && !agent.ready"></div>
          </div>
        </div>
      </template>
    </div>

    <div class="center">
      <button
        class="btn"
        type="submit"
        :disabled="state !== State.SETUP"
      >
        Start
      </button>
    </div>
  </form>

  <div
    id="game"
    class="game-container"
    x-data="Game()"
    x-cloak
    @updategame.window="update($event.detail.width, $event.detail.height, $event.detail.k)"
    @startgame.window="start($event.detail.agents)"
  >
    <div
      class="board"
      :class="{ 'board--started': state === State.PLAY || state == State.WAIT }"
      :style="`--columns: ${board.width}; --rows: ${board.height};`"
    >
      <template
        x-for="(cell, index) in board.cells"
        :key="index"
      >
        <div
          class="board__cell"
          :class="{
            'board__cell--empty': cell === null,
            'board__cell--active': state === State.PLAY && cell === null,
            'board__cell--p1': cell === 0,
            'board__cell--p2': cell === 1
          }"
          @click="handleCellClicked(index)"
          :x-ref="`cell-${index}`"
        ></div>
      </template>
    </div>
  </div>

  <div
    x-data="{ message: '', show: false }"
    x-cloak
    class="notification"
    :class="{ 'notification--hidden': !show }"
    @flash.window="
      message = $event.detail.message;
      show = true;
      setTimeout(() => { show = false; }, $event.detail.time);
    "
  >
    <p x-text="message"></p>
  </div>
</body>
</html>

